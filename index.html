<!doctype html>
<html lang="it">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Doodles Overlays â€” Gallery</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@500;600&display=swap" rel="stylesheet">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#0f1115">

<link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Doodles">

<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/sw.js').catch(()=>{});
  }
</script>

<style>
  :root{ --bg:#0f1115; --card:#171a21; --text:#eef2ff; --muted:#9aa3b2; --acc:#8ab4ff; --border:#232938;
         --footer-space: calc(44px + env(safe-area-inset-bottom));
  }
  *{box-sizing:border-box}
  
  /*html, body { height: 100%; }*/
  body{
    min-height: 100svh;      /* meglio di 100vh su mobile */
    display: flex;
    flex-direction: column;
  }
  .wrap{ flex: 1 0 auto; }    /* il contenuto riempie lo spazio e spinge il footer in basso */
  
    }
  /* centratura SOLO del blocco titolo+descrizione */
  .hero{ text-align:center; margin:8px 0 18px }
  .hero h1 {
    margin: 0 0 6px;
    font-size: clamp(26px, 3vw, 36px); /* circa il doppio di p */
    font-weight: 600;
  }
  
  .hero p {
    margin: 0;
    color: var(--muted);
    font-size: clamp(13px, 1.5vw, 18px);
    line-height: 1.35;
  }


  .toolbar{display:grid; grid-template-columns: 1fr auto; gap:12px; align-items:end; margin:12px 0 18px}
  .toolbar .field{display:flex; gap:8px; align-items:center}
  .toolbar input{padding:10px 12px; border-radius:12px; border:1px solid var(--border); background:#0d1016; color:var(--text); width:220px}
  .grid{
    display:grid;
    grid-template-columns: repeat(auto-fill, minmax(256px, 256px));
    gap:18px;
    justify-content: center; /* <-- centra le colonne dentro il contenitore */
  }
  .grid{ justify-items: center; } /* opzionale */
  .card{background:var(--card); border:1px solid var(--border); border-radius:16px; overflow:hidden; box-shadow:0 10px 30px rgba(0,0,0,.25); position:relative; transition:transform .08s ease, box-shadow .08s ease}
  .card:hover{transform:translateY(-2px); box-shadow:0 16px 36px rgba(0,0,0,.35)}
  .thumb{position:relative; aspect-ratio:1/1; background:#0d1016}
  .thumb img{width:100%; height:100%; object-fit:cover; display:block}
  .badge{position:absolute; top:8px; left:8px; padding:4px 8px; border-radius:10px; font-size:11px; font-weight:600; background:#fff;color:#0F1116; }
  .titlebar{padding:10px 12px; border-top:1px solid var(--border); background:linear-gradient(0deg, rgba(0,0,0,.45), rgba(0,0,0,.15))}
  .name{font-size:15px; font-weight:600}
  .by{font-size:12px; color:var(--muted)}
  a.cardlink{position:absolute; inset:0; display:block; text-decoration:none; color:inherit}
  .empty{opacity:.8; text-align:center; border:1px dashed var(--border); border-radius:12px; padding:18px}

/* Footer "made by" con shimmer â€” identico all'editor */
.footer-madeby{
  display:flex; justify-content:center; align-items:center;
  gap:0; margin:10px 0 0;
  font-family:'Fredoka', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}
.madeby-link{
  display:inline-flex; align-items:center; gap:0;
  text-decoration:none; color:inherit;
}
.madeby-link:hover{ text-decoration:underline; }
.footer-madeby{ white-space:nowrap; }
.madeby-link{ white-space:nowrap; }  
.footer-madeby{
  position: static;              /* default */
  display:flex; justify-content:center; align-items:center;
  gap:0; margin:12px 0 16px;
  padding-bottom: env(safe-area-inset-bottom); /* per iPhone con notch */
  white-space:nowrap;
  font-family:'Fredoka', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
}

/* Testo lucido */
.shimmer{
  --shine-start:rgba(192,192,192,.8);
  --shine-middle:rgba(255,255,255,1);
  --shine-end:rgba(192,192,192,.8);
  background-image:linear-gradient(120deg,
    var(--shine-start) 40%,
    var(--shine-middle) 50%,
    var(--shine-end) 60%
  );
  background-size:200% 100%;
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
  animation:shine 8s linear infinite;
  letter-spacing:.2px;
}
@keyframes shine{
  0%{ background-position:200% 0 }
  100%{ background-position:-200% 0 }
}
@media (prefers-reduced-motion: reduce){
  .shimmer{ animation: none !important; }
}


/* barra sticky che occupa spazio e centra il chip */
.navchip-bar{
  position: sticky;
  top: calc(12px + env(safe-area-inset-top)); /* sicuro anche con notch */
  z-index: 9999;
  display: flex;
  justify-content: center;
  padding: 4px 0;
}

/* puoi riusare le tue regole .navchip giÃ  messe;
   se non le hai, queste vanno bene: */
.navchip{
  display:inline-flex; align-items:center; gap:8px;
  padding:8px 14px; border-radius:999px;
  background: color-mix(in oklab, var(--card) 85%, transparent);
  border:1px solid var(--border);
  backdrop-filter: blur(8px);
  box-shadow:0 8px 24px rgba(0,0,0,.35);
  font:600 14px/1 'Fredoka', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  color:var(--text); text-decoration:none; white-space:nowrap;
  transition:border-color .15s ease, color .15s ease, transform .05s ease;
}
.navchip:hover{ color:var(--acc); border-color:var(--acc); }
.navchip:active{ transform: translateY(1px); }
:root{
  --sheen-width: 56px;     /* fascia un poâ€™ piÃ¹ larga = piÃ¹ morbida */
  --sheen-alpha: .18;      /* meno brillantezza */
  --sheen-angle: -14deg;   /* inclinazione piÃ¹ dolce */
  --sheen-from: -120%;     /* entra poco fuori a sinistra */
  --sheen-to: 220%;        /* esce poco fuori a destra */
  --sheen-dur: 5.2s;       /* passata piÃ¹ lenta */
  --sheen-delay: 1.2s;     /* piccola pausa tra le passate */
}

.navchip{ position:relative; overflow:hidden; }
/* ID nella hero */
.hero-id{ margin-top:12px; }
.hero-id-row{ display:flex; justify-content:center; gap:8px; }
.id-input{
  width:min(320px, 90vw);
  height:40px;
  padding:0 12px;
  border-radius:10px;
  border:1px solid var(--border);
  background:#0d1016;
  color:var(--text);
  font-size:16px; /* evita zoom iOS */
}
.id-input.error{ border-color:#ff4d4f; box-shadow:0 0 0 2px rgba(255,77,79,.2); }
.id-hint{ margin:6px 0 0; color:var(--muted); font-size:13px; }
.id-error{ margin:6px 0 0; color:#ff8082; font-size:13px; text-align:center; }

</style>
</head>
<body>
  <div class="navchip-bar">
    <a class="navchip" href="./Doodles_trait-viewer.html" title="Apri Trait Viewer">
      <span class="shine">Trait Viewer</span>
    </a>
  </div>
  
  <main class="wrap">
    <header class="hero">
      <h1>ARB8i ðŸ’› Lab</h1>
      <p>Pick a vibe! Overlay the fun!</p>
      <div class="hero-id">
      <label for="idField" class="sr-only">Doodles ID (0â€“9999)</label>
      <div class="hero-id-row">
        <input id="idField" class="id-input" type="text"
               inputmode="numeric" pattern="[0-9]*" autocomplete="off"
               placeholder="Doodles ID (0â€“9999)" />
      </div>
      <p class="id-hint">
        Inserisci ID e scegli un overlay.
        <a id="tvLink" href="./Doodles_trait-viewer.html?source=index">Non sai lâ€™ID? Apri il Trait Viewer</a>
      </p>
      <p id="idError" class="id-error" role="status" aria-live="polite" style="display:none"></p>
    </div>
    </header>

    <div id="grid" class="grid"></div>
    <div id="empty" class="empty" style="display:none">Nessun overlay nel manifest.</div>
  </main>

  <div class="footer-madeby">
    <a class="shimmer madeby-link" href="https://x.com/robottiandrea" target="_blank" rel="noopener">
      made by&nbsp;<span>ARB8i</span>â€“<span>@robottiandrea</span>
    </a>
  </div>

<script>
const GRID = document.getElementById('grid');
const EMPTY = document.getElementById('empty');
const idField = document.getElementById('idField');
const idError = document.getElementById('idError');

function normalizeId(v){
  const s = String(v||'').trim().replace(/\D+/g,'');
  if(s==='') return { value:'', valid:false, empty:true };
  const n = parseInt(s,10);
  if(Number.isFinite(n) && n>=0 && n<=9999) return { value:String(n), valid:true, empty:false };
  return { value:s, valid:false, empty:false };
}

function updateCardLinksWithId(id){
  document.querySelectorAll('a.cardlink').forEach(a=>{
    const u = new URL(a.getAttribute('href'), location.href);
    if(id==null){ u.searchParams.delete('id'); }
    else{ u.searchParams.set('id', id); }
    a.setAttribute('href', u.toString());
  });
}
  
let overlays = null;

function cardHTML(item){
  const href = new URL('editor.html', location.href);
  href.searchParams.set('overlay', item.id);

  const thumb = item.thumb || `thumbs/${item.id}.png`;
  const badge = item.badge ? `<div class="badge" style="${item.badgeColor?`background:${item.badgeColor}`:''}">${item.badge}</div>` : '';
  const by = item.author ? `<div class="by">by ${item.author}</div>` : '';

  return `
  <article class="card">
    <div class="thumb">
      ${badge}
      <img loading="lazy" src="${thumb}" alt="${item.name||item.id}" />
    </div>
    <div class="titlebar">
      <div class="name">${item.name||item.id}</div>
      ${by}
    </div>
    <a class="cardlink" href="${href.toString()}"></a>
  </article>`;
}

function render(){
  if(!overlays || !overlays.items || overlays.items.length===0){
    GRID.innerHTML = '';
    if (EMPTY) EMPTY.style.display = '';
    return;
  }
  if (EMPTY) EMPTY.style.display = 'none';
  GRID.innerHTML = overlays.items.map(cardHTML).join('');
  const n = idField ? normalizeId(idField.value) : {valid:false};
  updateCardLinksWithId(n.valid ? n.value : null);

}
(function initIdField(){
  if(!idField) return;

  // Enter disabilitato
  idField.addEventListener('keydown', (e)=>{ if(e.key==='Enter') e.preventDefault(); });

  // Prefill da query ?id= o da localStorage
  const sp = new URLSearchParams(location.search);
  let fromQuery = sp.get('id');
  if(fromQuery != null){
    const nq = normalizeId(fromQuery);
    if(nq.valid){
      idField.value = nq.value;
      localStorage.setItem('lastId', nq.value);
      // i link saranno aggiornati dopo render(); intanto puliamo l'URL
    }
    sp.delete('id');
    const q = sp.toString();
    history.replaceState(null, '', location.pathname + (q?('?'+q):''));
  }else{
    const last = localStorage.getItem('lastId');
    const nl = normalizeId(last);
    if(nl.valid) idField.value = nl.value;
  }

  // On input: normalizza, valida, persisti, aggiorna link
  idField.addEventListener('input', ()=>{
    const n = normalizeId(idField.value);
    idField.value = n.value;

    if(n.empty){
      idField.classList.remove('error');
      idError.style.display = 'none';
      localStorage.removeItem('lastId');
      updateCardLinksWithId(null);
      return;
    }
    if(n.valid){
      idField.classList.remove('error');
      idError.style.display = 'none';
      localStorage.setItem('lastId', n.value);
      updateCardLinksWithId(n.value);
    }else{
      idField.classList.add('error');
      idError.textContent = 'Inserisci un numero da 0 a 9999';
      idError.style.display = '';
      updateCardLinksWithId(null);
    }
  });
})();

async function loadManifest(){
  for (const url of ['./overlays/overlays.json','./overlays.json']){
    try{ const r = await fetch(url); if(r.ok){ overlays = await r.json(); return; } }catch{}
  }
  overlays = { items: [] };
}

loadManifest().then(render).catch(()=>{ overlays = { items: [] }; render(); });
</script>

</body>


</html>
